<!DOCTYPE html>
<html>
	<head>
<style>
			*{
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}
			body{
				background-color: #6493af;
				color: black;
			}
			table{
				width: 100%;
				height: 100%;
				border:2px solid gray;
				text-align: center;
				overflow: auto;
			}
			caption{
				font-size: 24px;
			}
			thead>tr{
				background-color: pink;
			}
			tbody>tr:nth-child(odd){
				background-color: rgb(145, 152, 174);
			}
			tbody>tr:nth-child(even){
				background-color: rgb(87, 90, 93);
			}
			
		</style>
	</head>
	<body>
		<table>
			<caption>收入支出记录表</caption>
			<thead>
				<tr>
					<th scope="col">收支</th>
					<th scope="col">类型</th>
					<th scope="col">时刻</th>
					<th scope="col">金额(元)</th>
					<th scope="col">备注</th>
					<th scope="col">谁的数据</th>
				</tr>
			</thead>
			<tbody></tbody>
		</table>
		
	</body>
</html>
<script>
	window.addEventListener('load',function(){
		let xhr = new XMLHttpRequest();
		xhr.open('GET',"./data.json");
		xhr.responseType = 'json';
		xhr.send();
		xhr.onload = ()=>{
			let resp = xhr.response;
			populateData(resp);
		}
		let tbody = document.querySelector('tbody');
		
		function populateData(data){
			for(let item of data){
				let newTr = document.createElement("tr");
				
				// addTd(newTr,'select',item.inOrOut);
				// addTd(newTr,'select',item.type);
				// addTd(newTr,'date',item.time);
				// addTd(newTr,'',item.amount);
				// addTd(newTr,'',item.notice);
				// addTd(newTr,'',item.belong);
				
				// newTr.addEventListener('blur',()=>{
				// 	/*检查失焦的行数据是否被更改，若被更改则将整行数据发送至后端*/
				// 	//与请求的JSON数据比对，看数据是否被更改
					
				// })
				
				fillLine(item,newTr);
				
				tbody.appendChild(newTr);
			}
		}
	});
	function addTd(tr,elementName,data){
		let td = document.createElement("td");
		let domNode ;
		switch(elementName){
			case 'select':
				let option = document.createElement("option");
				option.textContent = data;
				domNode = document.createElement('select');
				domNode.appendChild(option);
				break;
			case 'date':
				domNode = document.createElement('input');
				domNode.setAttribute('type','date');
				domNode.setAttribute('value',data);
				break;
			default:
				domNode = document.createElement("input");
				domNode.setAttribute("type","text");
				domNode.setAttribute("value",data);
				domNode.textContent = data;
				domNode.addEventListener('blur',e=>{
					
				})
		}
		domNode.style.width="100%";
		domNode.style.textAlign="center";
		td.appendChild(domNode);
		tr.appendChild(td);
	}
	
	/*待提交后端写入数据库的数据*/
	let neededSubmitLineData = {
		id:'',
		inOrOut:'',
		type:'',
		amount: '',
		notice:'',
		belong:''
	};
	
	function fillLine(obj,tr){// obj-json对象数组中的一个对象 ; tr 是一个<tr>节点
		for(let field in obj){
			if('id'== field) continue;
			let td = document.createElement('td');
			let node ;
			switch(field){
				case 'inOrOut':
					node = createElement('select',obj.inOrOut);
					// node.addEventListener('blur',e=>{
					// 	if(obj.inOrOut!==e.target.value){
					// 		neededSubmitLineData.id = obj.id;
					// 		neededSubmitLineData.inOrOut = e.target.value;
					// 	}
					// });
					addListenerForNode(node,obj,field);
					break;
				case 'type':
					node = createElement('select',obj.type);
					// node.addEventListener('blur',e=>{
					// 	if(obj.type!== e.target.value){
					// 		neededSubmitLineData.id = obj.id;
					// 		neededSubmitLineData.type = e.target.value;
					// 	}
					// });
					addListenerForNode(node,obj,field);
					break;
				case 'time':
					node = createElement('dateInput',obj.time);
					// node.addEventListener('blur',e=>{
					// 	if(obj.time!==e.target.value){
					// 		neededSubmitLineData.id = obj.id;
					// 		neededSubmitLineData.time =e.target.value;
					// 	}
					// });
					addListenerForNode(node,obj,field);
					break;
				default:
					node = createElement('input',obj[field]);
					// node.addEventListener('blur',e=>{
					// 	if(obj[field]!== e.target.value){
					// 		neededSubmitLineData.id = obj.id;
					// 		neededSubmitLineData[field] = e.target.value;
					// 	}
					// })
					addListenerForNode(node,obj,field);
			}
			td.appendChild(node);
			tr.appendChild(td);
		}
	}
	function createElement(elementName,data){
		let node ;
		switch(elementName){
			case 'select':
				let opt = document.createElement("option");
				// opt.setAttribute('value',data); 这么写无效
				opt.textContent = data;
				node = document.createElement('select');
				node.appendChild(opt);
				break;
			case 'dateInput':
				node = document.createElement('input');
				node.setAttribute('type','date');
				node.setAttribute('value',data);
				// node.textContent = data;. 这么写无效
				break;
			default:
				node = document.createElement('input');
				node.setAttribute('type','text');
				node.setAttribute('value',data);
				node.style.width = '100%';
		}
		return node;
	}
	
	function addListenerForNode(node,obj,field){//field 是属性名 obj是对象
		node.addEventListener('blur',e=>{
			if(obj[field]!==e.target.value){
				neededSubmitLineData.id = obj.id;
				neededSubmitLineData[field] =e.target.value;
			}
		});
	}
</script>
<!-- 吃-eating
穿-clothing
住-living
行-walking
育-teaching
醫-curing
借-borrow
債-debt
需-need
玩-play -->